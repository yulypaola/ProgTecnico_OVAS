<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gu√≠a Unidad 2 ‚Äî Control de ciclos</title>

  <style>
    :root {
      --bg: #0b0f19; --panel: #0f172a; --text: #e5e7eb; --muted: #94a3b8;
      --ring: rgba(255,255,255,.10); --btn: rgba(255,255,255,.08); --btn-bd: rgba(255,255,255,.18);
    }
    html,body {
      height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif;
    }
    .wrap {
      display:flex; align-items:center; justify-content:center; height:100%;
      padding:16px; box-sizing:border-box;
    }
    #book {
      position:relative; max-width:95vw; max-height:90vh;
      background:#111827; border-radius:16px; overflow:hidden;
      box-shadow:0 12px 34px rgba(0,0,0,.38),
                 inset 0 1px 0 rgba(255,255,255,.03),
                 inset 0 24px 48px rgba(0,0,0,.18);
      touch-action:none;
    }
    #book::after {
      content:''; position:absolute; top:4%; bottom:4%; left:50%; width:3px; transform:translateX(-50%);
      background:linear-gradient(to bottom,transparent,rgba(0,0,0,.4),transparent);
      opacity:.25; pointer-events:none; filter:blur(.2px);
    }
    #book[data-mode="single"]::after{display:none}
    .loading{text-align:center;opacity:.85;padding:18px}

    /* Controles */
    .controls{
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      display:flex; gap:10px; align-items:center; background:rgba(15,23,42,.92);
      padding:8px 12px; border-radius:999px; backdrop-filter:blur(8px); z-index:10000;
      border:1px solid var(--ring); box-shadow:0 8px 24px rgba(0,0,0,.35);
    }
    .btn{color:#fff;background:var(--btn);border:1px solid var(--btn-bd);padding:6px 10px;border-radius:10px;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    #status{min-width:72px;text-align:center;color:var(--muted);font-weight:600}

    /* Lupa */
    .viewer{position:fixed;inset:0;background:rgba(2,6,23,.92);display:none;align-items:center;justify-content:center;z-index:11000}
    .viewer.open{display:flex}
    .viewer__img-wrap{position:relative;overflow:hidden;max-width:95vw;max-height:92vh;cursor:grab;border-radius:14px;border:1px solid var(--ring);background:#0b1220}
    .viewer__img-wrap:active{cursor:grabbing}
    .viewer__img{user-select:none;pointer-events:none;transform-origin:0 0;will-change:transform;display:block}
    .viewer__bar{position:fixed;top:16px;left:50%;transform:translateX(-50%);display:flex;gap:10px;align-items:center;background:rgba(15,23,42,.92);padding:8px 12px;border-radius:999px;border:1px solid var(--ring)}
    .viewer__close{position:fixed;top:16px;right:16px}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="book"><div class="loading">Cargando‚Ä¶</div></div>
  </div>

  <!-- Barra de controles -->
  <div class="controls">
    <button id="prev" class="btn" title="P√°gina anterior (‚Üê)">‚óÄÔ∏é</button>
    <span id="status">‚Äì / ‚Äì</span>
    <button id="next" class="btn" title="P√°gina siguiente (‚Üí)">‚ñ∂Ô∏é</button>
    <button id="auto" class="btn" title="Auto pasar p√°ginas">Auto ‚ñ∑</button>
    <button id="zoom" class="btn" title="Lupa / Ver en detalle">üîç</button>
  </div>

  <!-- Visor (lupa) -->
  <div id="viewer" class="viewer" aria-hidden="true">
    <div class="viewer__bar">
      <button id="zOut" class="btn">‚àí</button>
      <button id="zFit" class="btn">Ajustar</button>
      <button id="zIn" class="btn">+</button>
    </div>
    <button id="vClose" class="btn viewer__close">Cerrar ‚úï</button>
    <div id="vWrap" class="viewer__img-wrap">
      <img id="vImg" class="viewer__img" src="" alt="">
    </div>
  </div>

  <!-- Librer√≠as -->
  <script src="./vendor/jquery.min.js"></script>
  <script src="./vendor/turn.min.js"></script>

  <!-- Script del visor -->
  <script>
  (async function(){
    const PAGES = [
      "images/page-001.png","images/page-002.png","images/page-003.png","images/page-004.png",
      "images/page-005.png","images/page-006.png","images/page-007.png","images/page-008.png",
      "images/page-009.png","images/page-010.png","images/page-011.png","images/page-012.png",
      "images/page-013.png","images/page-014.png","images/page-015.png"
    ];

    const first = await new Promise((res,rej)=>{
      const i = new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=PAGES[0];
    });
    const ratio = first.naturalHeight / first.naturalWidth;

    const container = document.getElementById('book');
    container.innerHTML = '';

    function mount(){
      const book = document.getElementById('book');
      const $ = window.jQuery;

      PAGES.forEach((src,idx)=>{
        const page = document.createElement('div');
        if(idx===0 || idx===PAGES.length-1) page.className='hard';
        const img=document.createElement('img');
        img.src=src; img.alt=''; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='contain';
        img.draggable=false;
        page.appendChild(img);
        book.appendChild(page);
      });

      const isMobile=()=>window.innerWidth<992;
      const maxBookW=()=>Math.min(window.innerWidth*0.95,1400);
      const compute=()=>{
        const maxW=maxBookW();
        const controls=document.querySelector('.controls');
        const availableH=Math.max(200,window.innerHeight-(controls?.offsetHeight||0)-24);
        const maxPageWByWidth=isMobile()?maxW:Math.floor(maxW/2);
        const maxPageWByHeight=Math.round(availableH/ratio);
        const pageWidth=Math.max(180,Math.min(maxPageWByWidth,maxPageWByHeight));
        const bookWidth=isMobile()?pageWidth:pageWidth*2;
        const bookHeight=Math.round(pageWidth*ratio);
        return {pageWidth,bookWidth,bookHeight};
      };

      const s0=compute();
      $(book).turn({
        width:s0.bookWidth, height:s0.bookHeight,
        display:isMobile()?'single':'double',
        autoCenter:true, elevation:80, acceleration:true,
        duration:900, gradients:true
      });
      book.setAttribute('data-mode',isMobile()?'single':'double');

      const prev=document.getElementById('prev');
      const next=document.getElementById('next');
      const status=document.getElementById('status');
      function updateStatus(){
        const c=$(book).turn('page');
        status.textContent=c+' / '+PAGES.length;
        prev.disabled=c<=1; next.disabled=c>=PAGES.length;
      }
      updateStatus();

      const onResize=()=>{
        const s=compute();
        try{$(book).turn('display',isMobile()?'single':'double');}catch{}
        try{$(book).turn('size',s.bookWidth,s.bookHeight);}catch{}
        try{$(book).turn('center');}catch{}
        book.setAttribute('data-mode',isMobile()?'single':'double');
        updateStatus();
      };
      window.addEventListener('resize',onResize);

      prev.onclick=()=>$(book).turn('previous');
      next.onclick=()=>$(book).turn('next');
      $(book).bind('turned',updateStatus);

      // Clic en zona izquierda/derecha
      book.addEventListener('click',e=>{
        const rect=book.getBoundingClientRect();
        const x=e.clientX-rect.left;
        if(x<rect.width/2) $(book).turn('previous'); else $(book).turn('next');
      });

      // Teclas ‚Üê ‚Üí
      window.addEventListener('keydown',e=>{
        if(e.key==='ArrowLeft'){e.preventDefault();$(book).turn('previous');}
        if(e.key==='ArrowRight'){e.preventDefault();$(book).turn('next');}
      });

      // Auto pasar p√°ginas
      const autoBtn=document.getElementById('auto');
      let autoTimer=null;
      function startAuto(){
        stopAuto();
        autoTimer=setInterval(()=>{
          const p=$(book).turn('page');
          if(p>=PAGES.length){stopAuto();return;}
          $(book).turn('next');
        },5000);
        autoBtn.textContent='Auto ‚è∏';
      }
      function stopAuto(){
        if(autoTimer) clearInterval(autoTimer);
        autoTimer=null;
        autoBtn.textContent='Auto ‚ñ∑';
      }
      startAuto();
      autoBtn.onclick=()=>autoTimer?stopAuto():startAuto();

      // Lupa / visor
      const viewer=document.getElementById('viewer');
      const vWrap=document.getElementById('vWrap');
      const vImg=document.getElementById('vImg');
      const btnZoom=document.getElementById('zoom');
      const btnClose=document.getElementById('vClose');
      const zIn=document.getElementById('zIn');
      const zOut=document.getElementById('zOut');
      const zFit=document.getElementById('zFit');
      let scale=1,pan={x:0,y:0},dragging=false,start={x:0,y:0};

      function setTransform(){vImg.style.transform=`translate(${pan.x}px,${pan.y}px) scale(${scale})`;}
      function fitToScreen(){
        const cw=vWrap.clientWidth,ch=vWrap.clientHeight;
        const iw=vImg.naturalWidth,ih=vImg.naturalHeight;
        const s=Math.min(cw/iw,ch/ih);
        scale=Math.max(1,s); pan={x:0,y:0}; setTransform();
      }
      function openViewer(){
        const p=$(book).turn('page');
        const curr=book.querySelector(`div:nth-child(${p}) img`);
        if(!curr)return;
        vImg.src=curr.src; viewer.classList.add('open');
        if(vImg.complete)fitToScreen(); else vImg.onload=fitToScreen;
      }
      function closeViewer(){viewer.classList.remove('open');}
      btnZoom.onclick=openViewer; btnClose.onclick=closeViewer;
      zIn.onclick=()=>{scale=Math.min(scale*1.25,8);setTransform();};
      zOut.onclick=()=>{scale=Math.max(scale/1.25,0.5);setTransform();};
      zFit.onclick=fitToScreen;
      vWrap.addEventListener('pointerdown',e=>{dragging=true;start={x:e.clientX-pan.x,y:e.clientY-pan.y};vWrap.setPointerCapture(e.pointerId);});
      vWrap.addEventListener('pointermove',e=>{if(!dragging)return;pan.x=e.clientX-start.x;pan.y=e.clientY-start.y;setTransform();});
      vWrap.addEventListener('pointerup',()=>dragging=false);
    }
    mount();
  })();
  </script>
</body>
</html>
